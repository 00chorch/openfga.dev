"use strict";(self.webpackChunkopenfga_dev=self.webpackChunkopenfga_dev||[]).push([[1217],{44179:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var i=n(87462),s=(n(67294),n(3905)),a=n(80450);const o={sidebar_position:2,slug:"/modeling/building-blocks/usersets"},r="Usersets",l={unversionedId:"content/modeling/building-blocks/usersets",id:"content/modeling/building-blocks/usersets",title:"Usersets",description:"What Is A Userset?",source:"@site/docs/content/modeling/building-blocks/usersets.mdx",sourceDirName:"content/modeling/building-blocks",slug:"/modeling/building-blocks/usersets",permalink:"/docs/modeling/building-blocks/usersets",draft:!1,editUrl:"https://github.com/openfga/openfga.dev/edit/main/docs/content/modeling/building-blocks/usersets.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,slug:"/modeling/building-blocks/usersets"},sidebar:"docs",previous:{title:"Object to Object Relationships",permalink:"/docs/modeling/building-blocks/object-to-object-relationships"},next:{title:"Advanced Use-Cases",permalink:"/docs/modeling/advanced"}},u={},d=[{value:"What Is A Userset?",id:"what-is-a-userset",level:2},{value:"How Do Check Requests Work With Usersets?",id:"how-do-check-requests-work-with-usersets",level:2},{value:"How Do Expand Requests Work With Usersets?",id:"how-do-expand-requests-work-with-usersets",level:2},{value:"Internals",id:"internals",level:2},{value:"Related Sections",id:"related-sections",level:2}],c={toc:d};function p(e){let{components:t,...o}=e;return(0,s.kt)("wrapper",(0,i.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"usersets"},"Usersets"),(0,s.kt)(a.AH,{mdxType:"DocumentationNotice"}),(0,s.kt)("h2",{id:"what-is-a-userset"},"What Is A Userset?"),(0,s.kt)("p",null,"A userset represents a set or collection of ",(0,s.kt)(a.uH,{section:"what-is-a-user",linkName:"users",mdxType:"ProductConcept"}),"."),(0,s.kt)("p",null,"Usersets can be used to indicate that a group of users in the system have a certain ",(0,s.kt)(a.uH,{section:"what-is-a-relation",linkName:"relation",mdxType:"ProductConcept"})," with an ",(0,s.kt)(a.uH,{section:"what-is-an-object",linkName:"object",mdxType:"ProductConcept"}),". This can be used to assign permissions to groups of users rather than specific ones, allowing us to represent the permissions in our system using less tuples and granting us flexibility in granting or denying access in bulk."),(0,s.kt)("p",null,"In ",(0,s.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"}),", usersets are represented via this notation: ",(0,s.kt)("inlineCode",{parentName:"p"},"object#relation"),", where ",(0,s.kt)(a.uH,{section:"what-is-an-object",linkName:"object",mdxType:"ProductConcept"})," is made up of a ",(0,s.kt)(a.uH,{section:"what-is-a-type",linkName:"type",mdxType:"ProductConcept"})," and an object identifier. For example:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"company:xyz#employee")," represents all users that are related to ",(0,s.kt)("inlineCode",{parentName:"li"},"company:xyz")," as ",(0,s.kt)("inlineCode",{parentName:"li"},"employee")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"tweet:12345#viewer")," represents all users that are related to ",(0,s.kt)("inlineCode",{parentName:"li"},"tweet:12345")," as ",(0,s.kt)("inlineCode",{parentName:"li"},"viewer"))),(0,s.kt)("h2",{id:"how-do-check-requests-work-with-usersets"},"How Do Check Requests Work With Usersets?"),(0,s.kt)("p",null,"Imagine the following authorization model:"),(0,s.kt)(a.lG,{configuration:{type_definitions:[{type:"org",relations:{member:{this:{}}}},{type:"document",relations:{reader:{this:{}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,s.kt)("p",null,"Now let us assume that the store has the following tuples:"),(0,s.kt)(a.Wz,{relationshipTuples:[{_description:'Userset "Members of the xyz org" can read the budget document',user:"org:xyz#member",relation:"reader",object:"document:budget"},{_description:'Anne is part of the userset "Members of the xyz org"',user:"anne",relation:"member",object:"org:xyz"}],mdxType:"RelationshipTuplesViewer"}),(0,s.kt)("p",null,"If we call the ",(0,s.kt)(a.uH,{section:"what-is-a-check-request",linkName:"check API",mdxType:"ProductConcept"})," to see if user ",(0,s.kt)("inlineCode",{parentName:"p"},"anne")," has a ",(0,s.kt)("inlineCode",{parentName:"p"},"reader")," relationship with ",(0,s.kt)("inlineCode",{parentName:"p"},"document:budget"),", ",(0,s.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"})," will check whether ",(0,s.kt)("inlineCode",{parentName:"p"},"anne")," is part of the userset that does have a ",(0,s.kt)("inlineCode",{parentName:"p"},"reader")," relationship. Because she is part of that userset, the request will return true:"),(0,s.kt)(a.uT,{user:"anne",relation:"reader",object:"document:budget",allowed:!0,mdxType:"CheckRequestViewer"}),(0,s.kt)("h2",{id:"how-do-expand-requests-work-with-usersets"},"How Do Expand Requests Work With Usersets?"),(0,s.kt)("p",null,"Imagine the following authorization model:"),(0,s.kt)(a.lG,{configuration:{type_definitions:[{type:"document",relations:{writer:{this:{}},reader:{union:{child:[{this:{}},{computedUserset:{relation:"writer"}}]}}}}]},mdxType:"AuthzModelSnippetViewer"}),(0,s.kt)("p",null,"If we wanted to see which users and usersets have a ",(0,s.kt)("inlineCode",{parentName:"p"},"reader")," relationship with ",(0,s.kt)("inlineCode",{parentName:"p"},"document:budget"),", we can call the ",(0,s.kt)("a",{parentName:"p",href:"/api/service#Relationship%20Queries/Expand"},"Expand API"),". The response will contain a userset tree where the leaf nodes are specific user IDs and usersets. For example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "tree": {\n    "root": {\n      "type": "document:budget#reader",\n      "union": {\n        "nodes": [\n          {\n            "type": "document:budget#reader",\n            "leaf": {\n              "users": {\n                "users": ["bob"]\n              }\n            }\n          },\n          {\n            "type": "document:budget#reader",\n            "leaf": {\n              "computed": {\n                "userset": "document:budget#writer"\n              }\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n')),(0,s.kt)("p",null,"As you can see from the response above, with usersets we can express ",(0,s.kt)("a",{parentName:"p",href:"/docs/configuration-language#the-union-operator"},"unions")," of user groups. We can also express ",(0,s.kt)("a",{parentName:"p",href:"/docs/configuration-language#the-intersection-operator"},"intersections")," and ",(0,s.kt)("a",{parentName:"p",href:"/docs/configuration-language#the-exclusion-operator"},"exclusions"),"."),(0,s.kt)("h2",{id:"internals"},"Internals"),(0,s.kt)("p",null,"Using the type definitions in the authorization model, some of the situations we can represent are:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"that a user is ",(0,s.kt)("strong",{parentName:"li"},"not")," in a set of users having a certain relation to an object, even if a relationship tuple exists in the system. See ",(0,s.kt)("a",{parentName:"li",href:"/docs/modeling/building-blocks/direct-relationships#2-with-direct-relationships-disabled"},"Disabling Direct Relationships")),(0,s.kt)("li",{parentName:"ul"},"that a user has a certain relationship with an object if they are in the ",(0,s.kt)("a",{parentName:"li",href:"/docs/configuration-language#the-union-operator"},"union"),", ",(0,s.kt)("a",{parentName:"li",href:"/docs/configuration-language#the-intersection-operator"},"intersection")," or ",(0,s.kt)("a",{parentName:"li",href:"/docs/configuration-language#the-exclusion-operator"},"exclusion")," of usersets."),(0,s.kt)("li",{parentName:"ul"},"that a user being in a set of users having a certain relation to an object can result in them having another relation to the object. See ",(0,s.kt)("a",{parentName:"li",href:"/docs/modeling/building-blocks/concentric-relationships"},"Concentric Relationships")),(0,s.kt)("li",{parentName:"ul"},"that the user being in a set of users having a certain relation to an object and that object is in a set of users having a certain relation to another object, can imply that the original user has a certain relationship to the final object. See ",(0,s.kt)("a",{parentName:"li",href:"/docs/modeling/building-blocks/object-to-object-relationships"},"Object-to-Object Relationships"))),(0,s.kt)("p",null,"When executing the Check API of the form ",(0,s.kt)("inlineCode",{parentName:"p"},"check(user, relation, object)"),", ",(0,s.kt)(a.rZ,{format:a.v7.ShortForm,mdxType:"ProductName"})," will perform the following steps:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"In the authorization model, look up ",(0,s.kt)("inlineCode",{parentName:"li"},"type")," and its ",(0,s.kt)("inlineCode",{parentName:"li"},"relation"),". Start building a tree where the root node will be the definition of that ",(0,s.kt)("inlineCode",{parentName:"li"},"relation"),", which can be a union, exclusion, or intersection of usersets, or it can be direct users."),(0,s.kt)("li",{parentName:"ol"},"Expand all the usersets involved into new nodes in the tree. This means recursively finding all the users that are members of the usersets. If there are direct relationships with users, create leaf nodes."),(0,s.kt)("li",{parentName:"ol"},"Check whether ",(0,s.kt)("inlineCode",{parentName:"li"},"user")," is a leaf node in the tree. If the API finds one match, it will return immediately and will not expand the remaining nodes.")),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Image showing the path &lt;ProductName format={ProductNameFormat.ShortForm}/&gt; traverses to find if a user is in the userset related to an object",src:n(80787).Z,width:"1411",height:"1027"})),(0,s.kt)("h2",{id:"related-sections"},"Related Sections"),(0,s.kt)(a.$q,{description:"See the following sections for more information:",relatedLinks:[{title:"Managing Group Membership",description:"How to add users to a userset",link:"../../interacting/managing-group-membership",id:"../../interacting/managing-group-membership.mdx"},{title:"Managing Group Access",description:"How to add permissions to a userset",link:"../../interacting/managing-group-access",id:"../../interacting/managing-group-access.mdx"}],mdxType:"RelatedSection"}))}p.isMDXComponent=!0},80787:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/usersets-check-tree-68f05e3f382b35ea6be97c5115223351.png"}}]);